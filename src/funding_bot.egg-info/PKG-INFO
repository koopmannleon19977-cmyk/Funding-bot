Metadata-Version: 2.4
Name: funding-bot
Version: 2.0.0
Summary: Delta-neutral funding rate arbitrage bot (Lighter <-> X10)
Author: Funding Bot Team
License: MIT
Project-URL: Homepage, https://github.com/your-org/funding-bot
Keywords: trading,arbitrage,funding-rate,defi,lighter,x10
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: aiohttp>=3.13.3
Requires-Dist: websockets>=12.0
Requires-Dist: certifi>=2026.1.4
Requires-Dist: aiosqlite>=0.19.0
Requires-Dist: eth-account>=0.10.0
Requires-Dist: pydantic>=2.5.0
Requires-Dist: pydantic-settings>=2.1.0
Requires-Dist: PyYAML>=6.0
Requires-Dist: orjson>=3.9.0
Requires-Dist: python-dotenv>=1.0.0
Requires-Dist: tenacity>=8.2.0
Requires-Dist: rich>=13.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.1.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: mypy>=1.7.0; extra == "dev"

# Funding Bot

**Delta-neutral Funding Rate Arbitrage Bot for Lighter and X10 Exchanges**

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Code style: ruff](https://img.shields.io/badge/code%20style-ruff-000000.svg)](https://github.com/astral-sh/ruff)

## Overview

Funding Bot is a sophisticated delta-neutral arbitrage system that exploits funding rate differentials between **Lighter** and **X10** perpetual futures exchanges. The bot maintains market-neutral positions by simultaneously going long on one exchange and short on the other, capturing the funding rate spread while hedging price risk.

### Key Features

- **Delta-Neutral Strategy**: Automatically hedges positions across exchanges
- **Real-time WebSocket Data**: Low-latency market data via WebSocket streams
- **Smart Execution**: Maker-first orders with intelligent IOC escalation
- **Advanced Exit Strategies**: Z-Score crash detection, funding velocity analysis, basis convergence
- **Risk Management**: Circuit breakers, liquidation monitoring, delta rebalancing
- **Coordinated Close**: Parallel close of both legs for optimal execution
- **SQLite Persistence**: Trade history, funding rates, and execution metrics

## Architecture

```
funding-bot/
├── main.py                    # Entry point
├── config/                    # Environment config
├── src/
│   ├── adapters/              # Exchange adapters (Lighter, X10)
│   ├── application/           # Application services (fees, reconciliation)
│   ├── core/                  # Core business logic (startup, trading, state)
│   ├── domain/                # Domain entities and rules
│   ├── funding_bot/           # Main bot package
│   │   ├── adapters/          # Exchange-specific implementations
│   │   ├── app/               # Application layer (run, supervisor)
│   │   ├── config/            # Settings and YAML config
│   │   ├── domain/            # Domain models (Trade, Position, Order)
│   │   ├── ports/             # Interface definitions (ExchangePort)
│   │   ├── services/          # Business services
│   │   │   ├── execution*.py  # Trade execution engine (Leg1/Leg2)
│   │   │   ├── opportunities/ # Opportunity scanning and scoring
│   │   │   ├── positions/     # Position management and exits
│   │   │   └── market_data/   # Market data service
│   │   └── observability/     # Logging and metrics
│   ├── infrastructure/        # Infrastructure (DB, WebSocket, Telegram)
│   └── utils/                 # Utilities
└── tests/                     # Unit and integration tests
```

## Quick Start

### Prerequisites

- Python 3.11 or higher
- Lighter Exchange API credentials
- X10 Exchange API credentials
- (Optional) Telegram Bot token for notifications

### Installation

```bash
# Clone the repository
git clone https://github.com/your-org/funding-bot.git
cd funding-bot

# Create virtual environment
python -m venv venv
source venv/bin/activate  # Linux/Mac
# or
.\venv\Scripts\activate   # Windows

# Install dependencies
pip install -e .

# Install exchange SDKs
pip install x10-python-trading-starknet>=0.0.17
pip install git+https://github.com/elliottech/lighter-python.git
```

### Configuration

1. **Create `.env` file** with your API credentials:

```env
# Lighter Exchange
LIGHTER_PRIVATE_KEY=your_private_key_here
LIGHTER_ACCOUNT_INDEX=0

# X10 Exchange
X10_API_KEY=your_api_key_here
X10_API_SECRET=your_api_secret_here
X10_STARK_PRIVATE_KEY=your_stark_key_here

# Telegram (Optional)
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

2. **Adjust `src/funding_bot/config/config.yaml`** for your trading parameters:

```yaml
# Key settings
live_trading: true           # false = paper trading (dry-run)
trading:
  desired_notional_usd: "350.0"  # Position size in USD
  max_open_trades: 1             # Maximum concurrent positions
  min_apy_filter: "0.35"         # Minimum 35% APY to enter
  min_hold_seconds: 172800       # 48 hours minimum hold time
```

### Running the Bot

```bash
# Start the bot
python main.py

# Or use the CLI
funding-bot

# Or use batch files (Windows)
start.bat
```

## Core Concepts

### Trading Strategy

1. **Opportunity Scanning**: Continuously monitors funding rates across both exchanges
2. **Entry Logic**: Enters when funding rate differential exceeds minimum APY threshold
3. **Position Opening**:
   - **Leg 1 (Lighter)**: Opens maker order on the paying side
   - **Leg 2 (X10)**: Hedges with IOC order on the receiving side
4. **Position Monitoring**: Tracks funding accrual, PnL, and exit conditions
5. **Exit Execution**: Coordinated close of both legs when exit criteria are met

### Exit Strategies

| Strategy | Description | Trigger |
|----------|-------------|---------|
| **Minimum Hold** | Basic time-based exit | After `min_hold_seconds` |
| **Early Take-Profit** | Price dislocation capture | Net PnL >= `early_take_profit_net_usd` |
| **Funding Flip** | Funding direction reversal | Funding turns unfavorable |
| **Z-Score Crash** | Statistical APY crash detection | Z-Score < -2.0 (2-sigma event) |
| **Funding Velocity** | Proactive crash prediction | Negative velocity + acceleration |
| **Basis Convergence** | Spread collapse detection | 80% spread reduction |
| **Net EV Exit** | Expected value negative | Exit costs > projected funding |
| **Opportunity Cost** | Better opportunity available | APY diff > 80% |
| **Delta Bound** | Hedge drift protection | Delta > 3% |

### Position Management

- **Delta Rebalancing**: Automatically rebalances when hedge drifts 1-3%
- **Coordinated Close**: Parallel execution on both legs
- **Ghost Position Handling**: Auto-import or close orphaned positions
- **Broken Hedge Recovery**: 15-minute cooldown after hedge failures

## Configuration Reference

See `src/funding_bot/config/config.yaml` for all available settings:

| Section | Key Settings |
|---------|--------------|
| `trading` | Position sizing, entry/exit thresholds, fees |
| `execution` | Order timeouts, maker/taker escalation, slippage |
| `risk` | Circuit breakers, drawdown limits, margin reserves |
| `websocket` | Connection parameters, health checks |
| `database` | SQLite path, pool size, WAL mode |
| `historical` | Backfill days, crash detection parameters |
| `telegram` | Notification settings |

## CLI Commands

```bash
# Standard run
python main.py

# Doctor mode (diagnostics)
python -m funding_bot doctor

# Reconcile positions
python -m funding_bot reconcile

# Close all positions
python -m funding_bot close-all

# Backfill historical data
python -m funding_bot backfill
```

## Testing

```bash
# Run all tests
pytest

# Run unit tests only
pytest -m unit

# Run with coverage
pytest --cov=src/funding_bot --cov-report=html

# Run specific test file
pytest tests/unit/test_execution.py -v
```

## Project Status

- **Version**: 2.0.0
- **Status**: Production-ready (Phase 1 Complete)
- **Tests**: 273+ unit tests passing

### Recent Improvements (2026-01)

- Performance optimizations (parallel evaluation, batch parallelization)
- Depth cache TTL (5s) for faster market data
- Reentrant logging fix for Windows Ctrl+C
- Code cleanup and linting (F401, E501)

## Documentation

- [Technical Documentation](docs/TECHNICAL.md) - Architecture and implementation details
- [User Guide](docs/USER_GUIDE.md) - Setup and operation guide
- [API Reference](docs/API_REFERENCE.md) - Module and class documentation

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'feat: add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

Please follow:
- [Conventional Commits](https://www.conventionalcommits.org/) for commit messages
- `ruff` for code formatting and linting
- Type hints for all new code

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Disclaimer

**This software is for educational and research purposes only.** Trading cryptocurrencies and derivatives carries significant risk. Past performance does not guarantee future results. Always conduct your own research and consider your risk tolerance before trading.
