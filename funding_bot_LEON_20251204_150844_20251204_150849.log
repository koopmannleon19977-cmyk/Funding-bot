15:08:49 [INFO]  CONFIG VALIDIERUNG abgeschlossen.
15:08:49 [INFO] ğŸ”¥ BOT V5 (Architected) STARTING...
15:08:49 [INFO] ğŸš€ Starting InMemoryStateManager...
15:08:49 [INFO] ğŸ“‚ Initializing database: data/trades.db
15:08:49 [INFO] âœ… Read pool created: 5 connections
15:08:49 [INFO] âœ… WAL mode enabled
15:08:49 [INFO] ğŸ”„ Running database migrations...
15:08:49 [INFO] âœ… Migrations complete (15 statements)
15:08:49 [INFO] âœ… Database initialized
15:08:49 [INFO] ğŸ–Šï¸ Database write loop started
15:08:49 [INFO] ğŸ“‚ Loaded 3 trades from database
15:08:49 [INFO] âœ… InMemoryStateManager started (loaded 3 trades)
15:08:49 [INFO] âœ… State Manager started
15:08:49 [INFO]  Telegram Bot disabled (Token/ChatID missing).
15:08:49 [INFO] âœ… Async database initialized
15:08:49 [INFO] ğŸ“ State writer loop started
15:08:49 [INFO] Initialisiere X10 Adapter...
15:08:49 [INFO]  X10 Account initialisiert.
15:08:49 [INFO] Initialisiere Lighter Adapter...
15:08:49 [INFO] ğŸ’° FeeManager initialized (Dynamic Fees: ENABLED)
15:08:49 [INFO] âœ… Lighter Fees updated: Maker=0.000000, Taker=0.000000 (source=config)
15:08:50 [INFO] âœ… X10 Fee Schedule from API: Maker=0.000000, Taker=0.000225
15:08:50 [INFO] âœ… X10 Fees updated: Maker=0.000000, Taker=0.000225 (source=api)
15:08:50 [INFO] âœ… FeeManager started with periodic refresh
15:08:50 [INFO] âœ… FeeManager started
15:08:50 [INFO] ğŸ“Š Loading Market Data via REST...
15:08:52 [INFO] âœ… Lighter: Loaded 116 markets (base data)
15:08:54 [INFO]  X10: 91 MÃ¤rkte geladen, 91 Funding Rates, 78 Preise
15:08:56 [INFO] âœ… Lighter: Updated 116 markets with size_decimals from API
15:08:56 [INFO] ğŸ“Š MARKET ADA-USD: size_decimals=1, price_decimals=5, min_base_amount=10.0
15:08:56 [INFO] ğŸ“Š MARKET SEI-USD: size_decimals=1, price_decimals=5, min_base_amount=50.0
15:08:56 [INFO] ğŸ“Š MARKET RESOLV-USD: size_decimals=0, price_decimals=6, min_base_amount=40.0
15:08:56 [INFO] ğŸ“Š MARKET TIA-USD: size_decimals=1, price_decimals=5, min_base_amount=3.0
15:08:56 [INFO] âœ… Markets loaded: X10=91, Lighter=116
15:08:56 [INFO] ğŸ“ˆ Pre-loading Lighter prices...
15:08:57 [INFO] âœ… Lighter prices loaded: 115 symbols
15:08:57 [INFO] ğŸ”¥ Warming up execution clients (Network Handshake)...
15:09:00 [INFO] âœ… Execution clients warmed up & NETWORK READY
15:09:00 [INFO] FundingPredictorV2 initialized with BTC Correlation
15:09:00 [INFO] ğŸ“‚ Loaded prediction history: 68 symbols
15:09:00 [INFO] âœ… FundingPredictorV2 started with persistence
15:09:00 [INFO] å¯åŠ¨ OI Tracker fÃ¼r 68 Symbole...
15:09:00 [INFO] âœ… OpenInterestTracker started (interval=15.0s)
15:09:00 [INFO] ğŸŒ Starting WebSocket Manager...
15:09:00 [INFO] ğŸ“Š OI Tracker: Starting cycle 1 (68 symbols)
15:09:00 [INFO] ğŸ”Œ [lighter] WebSocket manager started
15:09:00 [INFO] ğŸ”Œ [x10_account] WebSocket manager started
15:09:00 [INFO] ğŸ”Œ [x10_trades] WebSocket manager started
15:09:00 [INFO] ğŸ”Œ [x10_funding] WebSocket manager started
15:09:00 [INFO] ğŸ”Œ [lighter] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 20.0, 'ping_timeout': 10.0}
15:09:00 [INFO] ğŸ”Œ [x10_account] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
15:09:00 [INFO] ğŸ”Œ [x10_trades] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
15:09:00 [INFO] ğŸ”Œ [x10_funding] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
15:09:00 [INFO] âœ… WebSocketManager started (Lighter + X10 Account/Trades/Funding)
15:09:01 [INFO] âœ… [lighter] Connected to wss://mainnet.zklighter.elliot.ai/stream
15:09:01 [INFO] âœ… [lighter] Keepalive enabled: ping_interval=20.0s, ping_timeout=10.0s
15:09:01 [INFO] [lighter] Resubscribing to 87 channels (paced)...
15:09:01 [INFO] [lighter] Receive loop started (async iterator)
15:09:01 [INFO] âœ… [x10_account] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/account
15:09:01 [INFO] âœ… [x10_account] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
15:09:01 [INFO] [x10_account] Receive loop started (async iterator)
15:09:01 [INFO] âœ… [x10_trades] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/publicTrades
15:09:01 [INFO] âœ… [x10_trades] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
15:09:01 [INFO] [x10_trades] Receive loop started (async iterator)
15:09:01 [INFO] âœ… [x10_funding] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/funding
15:09:01 [INFO] âœ… [x10_funding] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
15:09:01 [INFO] [x10_funding] Receive loop started (async iterator)
15:09:02 [INFO] [x10] Connected to Firehose streams (Trades & Funding) for all markets.
15:09:02 [INFO] ğŸ”— Components Wired: WS -> OI Tracker -> Prediction
15:09:02 [INFO] ğŸ§Ÿ Starte Zombie-Check: Vergleiche DB mit echten Positionen...
15:09:02 [INFO] ğŸ” DB meldet 3 offene Trades. PrÃ¼fe Exchange...
15:09:02 [INFO] [lighter] Resubscribed to 87 channels
15:09:04 [INFO] Lighter: Found 0 open positions
15:09:04 [INFO] ğŸŒ Echte Positionen auf Exchanges: []
15:09:04 [WARNING] âš ï¸  ZOMBIE GEFUNDEN: WLFI-USD ist in DB offen, aber nicht auf Exchange. SchlieÃŸe ihn...
15:09:04 [INFO] âœ… Trade WLFI-USD closed (PnL: $0.00)
15:09:04 [WARNING] âš ï¸  ZOMBIE GEFUNDEN: APEX-USD ist in DB offen, aber nicht auf Exchange. SchlieÃŸe ihn...
15:09:04 [INFO] âœ… Trade APEX-USD closed (PnL: $0.00)
15:09:04 [WARNING] âš ï¸  ZOMBIE GEFUNDEN: 1000SHIB-USD ist in DB offen, aber nicht auf Exchange. SchlieÃŸe ihn...
15:09:04 [INFO] âœ… Trade 1000SHIB-USD closed (PnL: $0.00)
15:09:04 [INFO] ğŸ§Ÿ Reverse Ghost Check: Suche Positionen auf Exchange ohne DB Entry...
15:09:06 [INFO] Lighter: Found 0 open positions
15:09:06 [INFO] âœ… No orphaned positions found
15:09:06 [INFO] âœ… ParallelExecutionManager: Rollback processor started
15:09:06 [INFO] âœ… ParallelExecutionManager started
15:09:06 [INFO] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
15:09:06 [INFO]    BOT V5 RUNNING 24/7 - SUPERVISED | Ctrl+C = Stop   
15:09:06 [INFO] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
15:09:06 [INFO] ğŸš€ BotEventLoop starting...
15:09:06 [INFO] â–¶ï¸ Started task: connection_watchdog
15:09:06 [INFO] â–¶ï¸ Started task: logic_loop
15:09:06 [INFO] â–¶ï¸ Started task: trade_management_loop
15:09:06 [INFO] â–¶ï¸ Started task: farm_loop
15:09:06 [INFO] â–¶ï¸ Started task: maintenance_loop
15:09:06 [INFO] â–¶ï¸ Started task: cleanup_finished_tasks
15:09:06 [INFO] â–¶ï¸ Started task: health_reporter
15:09:06 [INFO] âœ… Started 7 tasks
15:09:06 [INFO] ğŸ”„ Rollback processor running...
15:09:06 [INFO] ğŸ• Connection Watchdog gestartet (Timeout: 120s)
15:09:06 [INFO] Logic Loop gestartet â€“ REFRESH alle 3s
15:09:06 [INFO] âš¡ Latency Arb Detector initialized (threshold: 5.0s)
15:09:06 [INFO] ğŸ” ğŸšœ FARM Scanning 68 pairs. Open symbols to skip: set()
15:09:06 [INFO] ğŸ” Scanning 68 pairs. Lighter markets: 116, X10 markets: 91
15:09:06 [INFO] ğŸ›¡ï¸ Trade Management Loop gestartet
15:09:06 [INFO] ğŸšœ Farm Mode ACTIVE
15:09:06 [INFO] ğŸ§  Prediction V2: Found 20 ML-ranked opportunities
15:09:06 [INFO] âœ… Returning 20 ML-ranked opportunities
15:09:06 [INFO] ğŸ¯ Found 3 opportunities, executing best...
15:09:07 [INFO] ğŸšœ Opening FARM: ADA-USD APY=23.7%
15:09:07 [INFO] X10: Detected balance = $297.61
15:09:07 [INFO] ğŸš€ Launching 2 trades (Slots available: 2)
15:09:08 [INFO] Lighter: Found 0 open positions
15:09:08 [INFO]  Volatility Monitor initialized: Low<3.0%, Normal<10.0%, High<20.0%, Hard Cap<50.0%
15:09:08 [INFO] ğŸ² KellyPositionSizer initialized (Safety=0.25, MaxFraction=0.1)
15:09:08 [INFO] ğŸ° KELLY ADA-USD: win_rate=60.0%, kelly_fraction=0.2000, safe_fraction=0.0250, confidence=LOW, samples=0
15:09:08 [INFO] ğŸ“Š KELLY SIZE ADA-USD: base=$30.0, kelly_recommended=$6.9, final=$30.0
15:09:08 [INFO] ğŸš€ Opening ADA-USD: Size=$30.0 (Min=$11.0)
15:09:08 [INFO] ğŸ”„ [PARALLEL] ADA-USD: Lighter POST-ONLY first
15:09:08 [INFO] ğŸš€ LIGHTER OPEN ADA-USD: side=SELL, size_usd=$30.00, price=$0.445320
15:09:08 [INFO] ğŸ”„ [PARALLEL] ADA-USD: X10 MARKET order
15:09:08 [INFO] Lighter Order: e7e200b878340c1429aee517b4cf77fe63b8b01c81e8134b18f35c31dc25bb95943a770eb4469644
15:09:09 [INFO]  X10: 91 MÃ¤rkte geladen, 91 Funding Rates, 82 Preise
15:09:09 [INFO] Lighter: Found 1 open positions
15:09:09 [INFO] ğŸ’° Balance: X10=$297.6 (free=$258.3), Lit=$276.8 (free=$237.5) | DB_Trades=0, Real_Positions=1, Locked=$5/ex
15:09:09 [INFO] ğŸš€ Launching trade for STRK-USD (APY=301406.2%)
15:09:09 [INFO] ğŸš€ Launching trade for APEX-USD (APY=255295.6%)
15:09:10 [INFO] Lighter: Found 1 open positions
15:09:10 [INFO] âœ… Launched 2 trade tasks this cycle
15:09:10 [INFO] Lighter: Found 1 open positions
15:09:10 [INFO] ğŸ” Running periodic exchange sync check...
15:09:10 [INFO] ğŸ” Starting Exchange Sync Check...
15:09:10 [INFO] â³ Sync check: Found 1 symbols with active executions: {'ADA-USD'}
15:09:11 [INFO]  X10 Order: 1996582522868187136
15:09:11 [INFO] âœ… [PARALLEL] ADA-USD: Both legs filled in 2828ms
15:09:11 [INFO] âœ… OPENED ADA-USD: $30.00 | Entry Fees (est.): $0.0067
15:09:11 [INFO] ğŸ° KELLY STRK-USD: win_rate=60.0%, kelly_fraction=0.2000, safe_fraction=0.0325, confidence=LOW, samples=0
15:09:11 [INFO] ğŸ“Š KELLY SIZE STRK-USD: base=$30.0, kelly_recommended=$8.0, final=$30.0
15:09:11 [INFO] ğŸ° KELLY APEX-USD: win_rate=60.0%, kelly_fraction=0.2000, safe_fraction=0.0325, confidence=LOW, samples=0
15:09:11 [INFO] ğŸ“Š KELLY SIZE APEX-USD: base=$30.0, kelly_recommended=$8.0, final=$30.0
15:09:11 [INFO] ğŸš€ Opening STRK-USD: Size=$30.0 (Min=$12.6)
15:09:11 [INFO] ğŸ”„ [PARALLEL] STRK-USD: Lighter POST-ONLY first
15:09:11 [INFO] ğŸš€ Opening APEX-USD: Size=$30.0 (Min=$11.0)
15:09:11 [INFO] ğŸ”„ [PARALLEL] APEX-USD: Lighter POST-ONLY first
15:09:11 [INFO] ğŸš€ LIGHTER OPEN STRK-USD: side=BUY, size_usd=$30.00, price=$0.120320
15:09:11 [INFO] ğŸ”„ [PARALLEL] STRK-USD: X10 MARKET order
15:09:11 [INFO] ğŸ”„ [PARALLEL] APEX-USD: X10 MARKET order
15:09:11 [INFO] ğŸš€ LIGHTER OPEN APEX-USD: side=BUY, size_usd=$30.00, price=$0.542380
15:09:11 [INFO] Lighter Order: 09216d6228575f6051947b84b1ef69ff025ff13132f836cdd0466d5bb67d492f232b3c9db3f39af4
15:09:11 [INFO] Lighter Order: 8abb4531154a403e77fe969b92e796ad7db01ce900685fb70c2d8b3759243f1f4f1b26b012e547b3
15:09:11 [INFO]  X10 Order: 1996582526009942016
15:09:11 [INFO] âœ… [PARALLEL] STRK-USD: Both legs filled in 375ms
15:09:11 [INFO] âœ… OPENED STRK-USD: $30.00 | Entry Fees (est.): $0.0067
15:09:12 [INFO] Lighter: Found 3 open positions
15:09:12 [INFO] ğŸ“Š Positions: X10=2, Lighter=3
15:09:13 [INFO]  X10 Order: 1996582530606071808
15:09:13 [INFO] âœ… [PARALLEL] APEX-USD: Both legs filled in 1469ms
15:09:13 [INFO] âœ… OPENED APEX-USD: $30.00 | Entry Fees (est.): $0.0067
15:09:15 [INFO] ğŸ’° ADA-USD: Entry fees updated - X10=0.000225, Lighter=0.000000, Total=$0.0002
15:09:16 [INFO] ğŸ’° STRK-USD: Entry fees updated - X10=0.000225, Lighter=0.000000, Total=$0.0002
15:09:17 [INFO] ğŸ’° APEX-USD: Entry fees updated - X10=0.000225, Lighter=0.000000, Total=$0.0002
15:09:18 [INFO] Lighter: Found 3 open positions
15:09:18 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:20 [WARNING] â¸ï¸ Sync check: Still 3 active executions after timeout: {'ADA-USD', 'STRK-USD', 'APEX-USD'}
15:09:20 [INFO] â³ Sync check: Skipping 3 symbols with active executions: {'ADA-USD', 'STRK-USD', 'APEX-USD'}
15:09:21 [INFO] Lighter: Found 3 open positions
15:09:21 [INFO] âœ… Exchanges are SYNCED: 3 paired positions
15:09:23 [INFO] ğŸ›‘ Initiating shutdown...
15:09:23 [INFO] Logic loop cancelled
15:09:23 [INFO] Connection watchdog cancelled
15:09:23 [ERROR] _GatheringFuture exception was never retrieved
future: <_GatheringFuture finished exception=CancelledError()>
Traceback (most recent call last):
  File "C:\Users\koopm\funding-bot\src\adapters\lighter_adapter.py", line 1281, in fetch_open_positions
    response = await account_api.account(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\pydantic\_internal\_validate_call.py", line 34, in wrapper_function
    return await wrapper(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\lighter\api\account_api.py", line 114, in account
    response_data = await self.api_client.call_api(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\lighter\api_client.py", line 274, in call_api
    response_data = await self.rest_client.request(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\lighter\rest.py", line 208, in request
    r = await pool_manager.request(**args)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\aiohttp\client.py", line 779, in _request
    resp = await handler(req)
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\aiohttp\client.py", line 757, in _connect_and_send_request
    await resp.start(conn)
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\aiohttp\client_reqrep.py", line 539, in start
    message, payload = await protocol.read()  # type: ignore[union-attr]
                       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\koopm\funding-bot\.venv\Lib\site-packages\aiohttp\streams.py", line 680, in read
    await self._waiter
asyncio.exceptions.CancelledError
15:09:26 [INFO] Lighter: Found 3 open positions
15:09:26 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:30 [INFO] Lighter: Found 3 open positions
15:09:31 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:36 [INFO] Lighter: Found 3 open positions
15:09:36 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:42 [INFO] Lighter: Found 3 open positions
15:09:42 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:47 [INFO] Lighter: Found 3 open positions
15:09:47 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:53 [INFO] Lighter: Found 3 open positions
15:09:53 [INFO] ğŸ“Š Positions: X10=3, Lighter=3
15:09:53 [WARNING] Force-killing 1 tasks
15:09:55 [INFO] ğŸ”Œ [x10_trades] WebSocket stopped
15:09:58 [ERROR] WebSocket stop error: 
15:09:58 [INFO] ğŸ›‘ Rollback processor: Shutdown signal received
15:09:58 [INFO] âœ… ParallelExecutionManager: Stopped
15:09:58 [INFO] ğŸ›‘ Stopping InMemoryStateManager...
15:09:58 [INFO] ğŸ“ State writer loop stopped
15:09:58 [INFO] âœ… InMemoryStateManager stopped
15:09:58 [INFO] âœ… Shutdown complete
15:09:58 [INFO] ğŸ›‘ Shutting down...
15:09:58 [INFO] ğŸ›‘ Shutdown requested...
15:09:58 [INFO] âœ… ParallelExecutionManager: Stopped
15:09:58 [INFO] ğŸ”Œ [x10_account] WebSocket stopped
15:09:58 [INFO] ğŸ”Œ [x10_trades] WebSocket stopped
15:09:58 [INFO] ğŸ”Œ [lighter] WebSocket stopped
15:09:58 [INFO] ğŸ”Œ [x10_funding] WebSocket stopped
15:09:58 [INFO] âœ… WebSocketManager stopped
15:09:58 [INFO] âœ… OpenInterestTracker stopped
15:09:58 [INFO] ğŸ›‘ Stopping InMemoryStateManager...
15:09:58 [INFO] âœ… InMemoryStateManager stopped
15:09:58 [INFO] ğŸ”’ Closing database...
15:09:58 [INFO] ğŸ–Šï¸ Database write loop stopped
15:09:58 [INFO] âœ… Database closed
15:09:58 [INFO] ğŸ›‘ FeeManager stopped
15:09:58 [INFO] âœ… X10 Adapter geschlossen.
15:09:58 [INFO] âœ… Lighter Adapter closed
15:09:58 [INFO] âœ… Bot V5 shutdown complete
