17:47:29 [INFO]  CONFIG VALIDIERUNG abgeschlossen.
17:47:29 [INFO] ğŸ”¥ BOT V5 (Architected) STARTING...
17:47:29 [INFO] ğŸš€ Starting InMemoryStateManager...
17:47:29 [INFO] ğŸ“‚ Initializing database: data/trades.db
17:47:29 [INFO] âœ… Read pool created: 5 connections
17:47:29 [INFO] âœ… WAL mode enabled
17:47:29 [INFO] ğŸ”„ Running database migrations...
17:47:29 [INFO] âœ… Migrations complete (11 statements)
17:47:29 [INFO] âœ… Database initialized
17:47:29 [INFO] ğŸ–Šï¸ Database write loop started
17:47:29 [INFO] ğŸ“‚ Loaded 2 trades from database
17:47:29 [INFO] âœ… InMemoryStateManager started (loaded 2 trades)
17:47:29 [INFO] âœ… State Manager started
17:47:29 [INFO]  Telegram Bot disabled (Token/ChatID missing).
17:47:29 [INFO] âœ… Async database initialized
17:47:29 [INFO] ğŸ“ State writer loop started
17:47:29 [INFO] Initialisiere X10 Adapter...
17:47:29 [INFO]  X10 Account initialisiert.
17:47:29 [INFO] Initialisiere Lighter Adapter...
17:47:29 [INFO] ğŸ’° FeeManager initialized (Dynamic Fees: ENABLED)
17:47:30 [WARNING] X10 fee refresh failed: cannot unpack non-iterable NoneType object, using fallback
17:47:30 [WARNING] Lighter fee refresh failed: cannot unpack non-iterable NoneType object, using fallback
17:47:30 [INFO] âœ… FeeManager started with periodic refresh
17:47:30 [INFO] âœ… FeeManager started
17:47:30 [INFO] ğŸ“Š Loading Market Data via REST...
17:47:30 [INFO] âœ… Lighter: Loaded 116 markets (base data)
17:47:33 [INFO]  X10: 91 MÃ¤rkte geladen, 91 Funding Rates, 78 Preise
17:47:33 [INFO] âœ… Lighter: Updated 116 markets with size_decimals from API
17:47:33 [INFO] ğŸ“Š MARKET ADA-USD: size_decimals=1, price_decimals=5, min_base_amount=10.0
17:47:33 [INFO] ğŸ“Š MARKET SEI-USD: size_decimals=1, price_decimals=5, min_base_amount=50.0
17:47:33 [INFO] ğŸ“Š MARKET RESOLV-USD: size_decimals=0, price_decimals=6, min_base_amount=40.0
17:47:33 [INFO] ğŸ“Š MARKET TIA-USD: size_decimals=1, price_decimals=5, min_base_amount=3.0
17:47:33 [INFO] âœ… Markets loaded: X10=91, Lighter=116
17:47:33 [INFO] ğŸ“ˆ Pre-loading Lighter prices...
17:47:34 [INFO] âœ… Lighter prices loaded: 115 symbols
17:47:34 [INFO] ğŸ”¥ Warming up execution clients (Network Handshake)...
17:47:37 [INFO] âœ… Execution clients warmed up & NETWORK READY
17:47:37 [INFO] FundingPredictorV2 initialized with BTC Correlation
17:47:37 [INFO] å¯åŠ¨ OI Tracker fÃ¼r 68 Symbole...
17:47:37 [INFO] âœ… OpenInterestTracker started (interval=15.0s)
17:47:37 [INFO] ğŸŒ Starting WebSocket Manager...
17:47:37 [INFO] ğŸ“Š OI Tracker: Starting cycle 1 (68 symbols)
17:47:37 [INFO] ğŸ”Œ [lighter] WebSocket manager started
17:47:37 [INFO] ğŸ”Œ [x10_account] WebSocket manager started
17:47:37 [INFO] ğŸ”Œ [x10_trades] WebSocket manager started
17:47:37 [INFO] ğŸ”Œ [x10_funding] WebSocket manager started
17:47:37 [INFO] ğŸ”Œ [lighter] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 20.0, 'ping_timeout': 10.0}
17:47:37 [INFO] ğŸ”Œ [x10_account] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
17:47:37 [INFO] ğŸ”Œ [x10_trades] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
17:47:37 [INFO] ğŸ”Œ [x10_funding] Connecting with kwargs: {'close_timeout': 5.0, 'max_size': 4194304, 'ping_interval': 15.0, 'additional_headers': {'X-Api-Key': 'a1c9207f79f0e57ddc454bf1e16dbe49', 'User-Agent': 'X10PythonTradingClient/0.4.5'}}
17:47:37 [INFO] âœ… WebSocketManager started (Lighter + X10 Account/Trades/Funding)
17:47:38 [INFO] âœ… [lighter] Connected to wss://mainnet.zklighter.elliot.ai/stream
17:47:38 [INFO] âœ… [lighter] Keepalive enabled: ping_interval=20.0s, ping_timeout=10.0s
17:47:38 [INFO] [lighter] Resubscribing to 75 channels (paced)...
17:47:38 [INFO] [lighter] Receive loop started (async iterator)
17:47:38 [INFO] âœ… [x10_funding] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/funding
17:47:38 [INFO] âœ… [x10_funding] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
17:47:38 [INFO] [x10_funding] Receive loop started (async iterator)
17:47:38 [INFO] âœ… [x10_trades] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/publicTrades
17:47:38 [INFO] âœ… [x10_trades] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
17:47:38 [INFO] [x10_trades] Receive loop started (async iterator)
17:47:38 [INFO] âœ… [x10_account] Connected to wss://api.starknet.extended.exchange/stream.extended.exchange/v1/account
17:47:38 [INFO] âœ… [x10_account] Keepalive enabled: ping_interval=15.0s, ping_timeout=None (auto-pong)
17:47:38 [INFO] [x10_account] Receive loop started (async iterator)
17:47:39 [INFO] [lighter] Resubscribed to 75 channels
17:47:39 [INFO] [x10] Connected to Firehose streams (Trades & Funding) for all markets.
17:47:39 [INFO] ğŸ”— Components Wired: WS -> OI Tracker -> Prediction
17:47:39 [INFO] ğŸ§Ÿ Starte Zombie-Check: Vergleiche DB mit echten Positionen...
17:47:39 [INFO] ğŸ” DB meldet 2 offene Trades. PrÃ¼fe Exchange...
17:47:40 [INFO] Lighter: Found 2 open positions
17:47:40 [INFO] ğŸŒ Echte Positionen auf Exchanges: ['APT-USD', 'LINEA-USD']
17:47:40 [WARNING] âš ï¸  ZOMBIE GEFUNDEN: RESOLV-USD ist in DB offen, aber nicht auf Exchange. SchlieÃŸe ihn...
17:47:40 [INFO] âœ… Trade RESOLV-USD closed (PnL: $0.00)
17:47:40 [INFO] ğŸ§Ÿ Reverse Ghost Check: Suche Positionen auf Exchange ohne DB Entry...
17:47:41 [INFO] Lighter: Found 2 open positions
17:47:41 [WARNING] ğŸš¨ Found 1 ORPHANED positions: {'LINEA-USD'}
17:47:41 [WARNING] ğŸ§¹ Cleaning orphaned position: LINEA-USD
17:47:41 [INFO] Lighter LINEA-USD: size=-3500.0, closing as SELL, notional=$28.81
17:47:41 [INFO] ğŸ” DEBUG close_live_position ENTRY: symbol=LINEA-USD (type=<class 'str'>)
17:47:41 [INFO] ğŸ” DEBUG: original_side=SELL (type=<class 'str'>)
17:47:41 [INFO] ğŸ” DEBUG: notional_usd=28.808500000000002 (type=<class 'float'>)
17:47:42 [INFO] Lighter: Found 2 open positions
17:47:42 [INFO] ğŸ”» LIGHTER CLOSE LINEA-USD: size=-3500.000000 coins, side=BUY, price=$0.0082, notional=$28.81
17:47:42 [INFO] ğŸš€ LIGHTER OPEN LINEA-USD: side=BUY, size_usd=$28.81, price=$0.008231
17:47:42 [INFO] Lighter Order: 816393035958239b1779519810d79bdca3111d23d8b09b3864cc78979ea55d75b2f8dbaaa8f6cc4f
17:47:42 [INFO] âœ… Lighter close LINEA-USD: Erfolgreich ($28.81)
17:47:42 [INFO] âœ… Closed orphaned LINEA-USD
17:47:42 [INFO] âœ… ParallelExecutionManager: Rollback processor started
17:47:42 [INFO] âœ… ParallelExecutionManager started
17:47:42 [INFO] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
17:47:42 [INFO]    BOT V5 RUNNING 24/7 - SUPERVISED | Ctrl+C = Stop   
17:47:42 [INFO] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
17:47:42 [INFO] ğŸš€ BotEventLoop starting...
17:47:42 [INFO] â–¶ï¸ Started task: connection_watchdog
17:47:42 [INFO] â–¶ï¸ Started task: logic_loop
17:47:42 [INFO] â–¶ï¸ Started task: trade_management_loop
17:47:42 [INFO] â–¶ï¸ Started task: farm_loop
17:47:42 [INFO] â–¶ï¸ Started task: maintenance_loop
17:47:42 [INFO] â–¶ï¸ Started task: cleanup_finished_tasks
17:47:42 [INFO] â–¶ï¸ Started task: health_reporter
17:47:42 [INFO] âœ… Started 7 tasks
17:47:42 [INFO] ğŸ”„ Rollback processor running...
17:47:42 [INFO] ğŸ• Connection Watchdog gestartet (Timeout: 120s)
17:47:42 [INFO] Logic Loop gestartet â€“ REFRESH alle 3s
17:47:42 [INFO] âš¡ Latency Arb Detector initialized (threshold: 5.0s)
17:47:42 [INFO] ğŸ” ğŸšœ FARM Scanning 68 pairs. Open symbols to skip: {'APT-USD'}
17:47:42 [INFO] ğŸ” Scanning 68 pairs. Lighter markets: 116, X10 markets: 91
17:47:42 [INFO] ğŸ›¡ï¸ Trade Management Loop gestartet
17:47:42 [INFO] ğŸšœ Farm Mode ACTIVE
17:47:42 [INFO] âš ï¸ No prediction opportunities, using fallback logic...
17:47:42 [INFO]  Volatility Monitor initialized: Low<3.0%, Normal<10.0%, High<20.0%, Hard Cap<50.0%
17:47:42 [INFO] ğŸ’ RESOLV-USD | APY: 82.3%
17:47:42 [INFO] ğŸ’ AVNT-USD | APY: 51.7%
17:47:42 [INFO] ğŸ’ ONDO-USD | APY: 50.8%
17:47:42 [INFO] ğŸ’ KAITO-USD | APY: 63.1%
17:47:42 [INFO] âœ… Found 30 opportunities from 63 valid pairs (farm_mode=True, scanned=68)
17:47:42 [INFO] ğŸ¯ Found 3 opportunities, executing best...
17:47:42 [INFO] Lighter: Found 2 open positions
17:47:43 [INFO] ğŸ“Š Positions: X10=0, Lighter=2
17:47:43 [INFO] ğŸšœ Opening FARM: WLFI-USD APY=39.4%
17:47:43 [INFO] X10: Detected balance = $297.45
17:47:43 [INFO] ğŸš€ Launching 1 trades (Slots available: 1)
17:47:44 [INFO] Lighter: Found 2 open positions
17:47:44 [INFO] Lighter: Found 2 open positions
17:47:44 [INFO] ğŸ² KellyPositionSizer initialized (Safety=0.25, MaxFraction=0.1)
17:47:44 [INFO] ğŸ° KELLY WLFI-USD: win_rate=60.0%, kelly_fraction=0.2000, safe_fraction=0.0275, confidence=LOW, samples=0
17:47:44 [INFO] ğŸ“Š KELLY SIZE WLFI-USD: base=$30.0, kelly_recommended=$7.4, final=$30.0
17:47:44 [INFO] ğŸ’° Balance: X10=$297.4 (free=$284.8), Lit=$268.5 (free=$255.9) | DB_Trades=1, Real_Positions=2, Locked=$10/ex
17:47:44 [INFO] ğŸš€ Launching trade for RESOLV-USD (APY=82.3%)
17:47:44 [INFO] ğŸš€ Opening WLFI-USD: Size=$30.0 (Min=$15.7)
17:47:44 [INFO] ğŸ”„ [PARALLEL] WLFI-USD: Lighter POST-ONLY first
17:47:44 [INFO] ğŸš€ LIGHTER OPEN WLFI-USD: side=SELL, size_usd=$30.00, price=$0.149680
17:47:44 [INFO] ğŸ”„ [PARALLEL] WLFI-USD: X10 MARKET order
17:47:44 [INFO]  X10: 91 MÃ¤rkte geladen, 91 Funding Rates, 82 Preise
17:47:44 [INFO] Lighter: Found 2 open positions
17:47:44 [INFO] ğŸ“Š Positions: X10=0, Lighter=2
17:47:44 [INFO] Lighter Order: a7363ffe5f385ad476871a3afed24d55b531e5262f0a409c71f21f08837477f1a3d9bd1ebaa2128a
17:47:45 [INFO] âœ… Launched 1 trade tasks this cycle
17:47:45 [INFO] Lighter: Found 2 open positions
17:47:45 [INFO] ğŸ° KELLY RESOLV-USD: win_rate=60.0%, kelly_fraction=0.2000, safe_fraction=0.0300, confidence=LOW, samples=0
17:47:45 [INFO] ğŸ“Š KELLY SIZE RESOLV-USD: base=$30.0, kelly_recommended=$7.1, final=$30.0
17:47:45 [INFO] ğŸš€ Opening RESOLV-USD: Size=$30.0 (Min=$11.0)
17:47:45 [INFO] ğŸ”„ [PARALLEL] RESOLV-USD: Lighter POST-ONLY first
17:47:45 [INFO] ğŸš€ LIGHTER OPEN RESOLV-USD: side=SELL, size_usd=$30.00, price=$0.077846
17:47:45 [INFO] ğŸ”„ [PARALLEL] RESOLV-USD: X10 MARKET order
17:47:45 [INFO] Lighter Order: dd530c909fb48156846c6947179678ebe255d359bda2f39af21db8cf9da9ccae118be951ae9d4c70
17:47:47 [INFO]  X10 Order: 1996984816674836480
17:47:47 [INFO] âœ… [PARALLEL] WLFI-USD: Both legs filled in 2438ms
17:47:47 [INFO] âœ… OPENED WLFI-USD: $30.00 | Entry Fees (est.): $0.0067
17:47:47 [INFO] Lighter: Found 4 open positions
17:47:47 [INFO] ğŸ“Š Positions: X10=0, Lighter=4
17:47:47 [INFO] ğŸ” Running periodic exchange sync check...
17:47:47 [INFO] ğŸ” Starting Exchange Sync Check...
17:47:47 [INFO] â³ Sync check: Found 2 symbols with active executions: {'WLFI-USD', 'RESOLV-USD'}
17:47:48 [INFO] ğŸ” ğŸšœ FARM Scanning 68 pairs. Open symbols to skip: {'WLFI-USD', 'APT-USD'}
17:47:48 [INFO] ğŸ” Scanning 68 pairs. Lighter markets: 116, X10 markets: 91
17:47:48 [INFO] ğŸ§  Prediction V2: Found 3 ML-ranked opportunities
17:47:48 [INFO] âœ… Returning 3 ML-ranked opportunities
17:47:48 [INFO] ğŸ¯ Found 3 opportunities, executing best...
17:47:48 [INFO]  X10 Order: 1996984822958796800
17:47:48 [INFO] âœ… [PARALLEL] RESOLV-USD: Both legs filled in 2953ms
17:47:48 [INFO] âœ… OPENED RESOLV-USD: $30.00 | Entry Fees (est.): $0.0067
17:47:49 [INFO] X10: Detected balance = $297.44
17:47:49 [INFO] Lighter: Found 4 open positions
17:47:49 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:47:51 [INFO] ğŸ’° WLFI-USD: Entry fees updated - X10=0.000225, Lighter=0.000000, Total=$0.0002
17:47:52 [INFO] Lighter: Found 4 open positions
17:47:52 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:47:52 [INFO] ğŸ’° RESOLV-USD: Entry fees updated - X10=0.000225, Lighter=0.000000, Total=$0.0002
17:47:54 [INFO] Lighter: Found 4 open positions
17:47:54 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:47:57 [INFO] Lighter: Found 4 open positions
17:47:57 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:47:57 [WARNING] â¸ï¸ Sync check: Still 2 active executions after timeout: {'WLFI-USD', 'RESOLV-USD'}
17:47:57 [INFO] â³ Sync check: Skipping 2 symbols with active executions: {'WLFI-USD', 'RESOLV-USD'}
17:47:58 [INFO] Lighter: Found 4 open positions
17:47:58 [ERROR] ğŸš¨ DESYNC DETECTED: Positions only on Lighter: ['LINEA-USD']
17:47:58 [ERROR] âš ï¸ These are UNHEDGED and create directional risk!
17:47:58 [WARNING] ğŸ”» Closing orphaned Lighter position: LINEA-USD
17:47:58 [INFO] ğŸ” DEBUG close_live_position ENTRY: symbol=LINEA-USD (type=<class 'str'>)
17:47:58 [INFO] ğŸ” DEBUG: original_side=SELL (type=<class 'str'>)
17:47:58 [INFO] ğŸ” DEBUG: notional_usd=28.622999999999998 (type=<class 'float'>)
17:47:58 [INFO] Lighter: Found 4 open positions
17:47:58 [INFO] ğŸ”» LIGHTER CLOSE LINEA-USD: size=-3500.000000 coins, side=BUY, price=$0.0082, notional=$28.62
17:47:58 [INFO] ğŸš€ LIGHTER OPEN LINEA-USD: side=BUY, size_usd=$28.62, price=$0.008178
17:47:59 [INFO] Lighter Order: fd9d5833f2e87c5ffca9555cd8a99a6abb82eb591797fbba4779f0104b4f7d6360e2a7748e61a2c2
17:47:59 [INFO] âœ… Lighter close LINEA-USD: Erfolgreich ($28.62)
17:47:59 [INFO] âœ… Closed orphaned Lighter LINEA-USD
17:47:59 [INFO] Lighter: Found 4 open positions
17:47:59 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:48:02 [INFO] Lighter: Found 4 open positions
17:48:02 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:48:04 [INFO] Lighter: Found 4 open positions
17:48:04 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:48:07 [INFO] Lighter: Found 4 open positions
17:48:07 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:48:09 [INFO] Lighter: Found 4 open positions
17:48:09 [INFO] ğŸ“Š Positions: X10=2, Lighter=4
17:48:10 [INFO] ğŸ›‘ Initiating shutdown...
17:48:10 [INFO] Logic loop cancelled
17:48:10 [INFO] Connection watchdog cancelled
17:48:11 [INFO] ğŸ”Œ [x10_trades] WebSocket stopped
17:48:15 [ERROR] WebSocket stop error: 
17:48:15 [INFO] ğŸ›‘ Rollback processor: Shutdown signal received
17:48:15 [INFO] âœ… ParallelExecutionManager: Stopped
17:48:15 [INFO] ğŸ›‘ Stopping InMemoryStateManager...
17:48:15 [INFO] ğŸ“ State writer loop stopped
17:48:15 [INFO] âœ… InMemoryStateManager stopped
17:48:15 [INFO] âœ… Shutdown complete
17:48:15 [INFO] ğŸ›‘ Shutting down...
17:48:15 [INFO] ğŸ›‘ Shutdown requested...
17:48:15 [INFO] âœ… ParallelExecutionManager: Stopped
17:48:15 [INFO] ğŸ”Œ [x10_trades] WebSocket stopped
17:48:15 [INFO] ğŸ”Œ [lighter] WebSocket stopped
17:48:15 [INFO] ğŸ”Œ [x10_account] WebSocket stopped
17:48:15 [INFO] ğŸ”Œ [x10_funding] WebSocket stopped
17:48:15 [INFO] âœ… WebSocketManager stopped
17:48:15 [INFO] âœ… OpenInterestTracker stopped
17:48:15 [INFO] ğŸ›‘ Stopping InMemoryStateManager...
17:48:15 [INFO] âœ… InMemoryStateManager stopped
17:48:15 [INFO] ğŸ”’ Closing database...
17:48:15 [INFO] ğŸ–Šï¸ Database write loop stopped
17:48:15 [INFO] âœ… Database closed
17:48:15 [INFO] ğŸ›‘ FeeManager stopped
17:48:15 [INFO] âœ… X10 Adapter geschlossen.
17:48:15 [INFO] âœ… Lighter Adapter closed
17:48:15 [INFO] âœ… Bot V5 shutdown complete
